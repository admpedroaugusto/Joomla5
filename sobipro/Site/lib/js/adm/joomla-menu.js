/**
 * @package SobiPro Library
 *
 * @author
 * Name: Sigrid Suski & Radek Suski, Sigsiu.NET GmbH
 * Url: https://www.Sigsiu.NET
 *
 * @copyright Copyright (C) 2006â€“2024 Sigsiu.NET GmbH (https://www.sigsiu.net). All rights reserved.
 * @license GNU/LGPL Version 3
 * This program is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License version 3
 * as published by the Free Software Foundation, and under the additional terms according section 7 of GPL v3.
 * See https://www.gnu.org/licenses/lgpl.html and https://www.sigsiu.net/licenses.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
 *
 * @created 04 August 2012 by Radek Suski
 * @modified 21 June 2024 by Sigrid Suski
 */
let SobiProSelectedUrl="";function SP_selectCat(e){SobiPro.jQuery("input[name*=sid]").val(e),SobiPro.jQuery("#sigsiu_tree_categories_CatUrl"+e).focus(),SobiPro.jQuery.ajax({url:"index.php",data:{task:"category.parents",out:"json",option:"com_sobipro",format:"raw",tmpl:"component",sid:e},type:"post",dataType:"json"}).done((function(e){let t="";SobiPro.jQuery.each(e.categories,(function(e,o){t=o.name})),SobiPro.jQuery("input[name=function-name]").val(SobiPro.jQuery("#spctrl-category-name").html().replace("%s",t))}))}function SPUpdateUrl(){SobiPro.jQuery("#spctrl-selected-sid").val()||SobiPro.jQuery("#spctrl-selected-sid").val(SobiPro.jQuery("#spctrl-section").val()),""==SobiProSelectedUrl&&(SobiProSelectedUrl="index.php?option=com_sobipro&sid="+SobiPro.jQuery("#spctrl-section").val()),SobiPro.jQuery("#jform_link").val(SobiProSelectedUrl)}function SPValidate(){return SPUpdateUrl(),"0"!==SobiPro.jQuery("#spctrl-selected-sid").val()&&""!==SobiPro.jQuery("#spctrl-selected-sid").val()||(SobiPro.Alert("YOU_HAVE_TO_AT_LEAST_SELECT_A_SECTION"),!1)}SobiCore.Ready((()=>{let e=SobiPro.jQuery("#spctrl-modal");SobiProSelectedUrl=SobiPro.jQuery("#jform_link").val();let t=document.querySelector(".spctrl-menu-settings");t&&t.closest(".control-group").classList.add("hidden"),e.find(".spctrl-save").click((function(o){o.preventDefault();let r=e.find("iframe").contents().find("#SobiPro").find(":input"),i={},n=[];SobiPro.jQuery.each(r,(function(e,t){switch((t=SobiPro.jQuery(t)).attr("name")){case"sid":SobiPro.jQuery("#spctrl-selected-sid").val(t.val());break;case"function-name":let e=t.val();-1!=e.indexOf("%s")&&(e=e.replace("%s",SobiPro.jQuery("#spctrl-section").find(":selected").text())),SobiPro.jQuery("#spctrl-selected-function").html(e);break;default:if(t.attr("name")&&t.attr("name").length)if(-1!=t.attr("name").indexOf("params")){let e=t.attr("name").replace("params[","").replace("]","");i[e]=t.val()}else if(-1!=t.attr("name").indexOf("request")){let e=t.attr("name").replace("request[","").replace("]","");n.push({name:e,value:t.val()})}}}));let l=SPLiveSite+"index.php?option=com_sobipro&";if(n.length){let e=l,t=null;SobiPro.jQuery.each(n,(function(o,r){r.value.length&&("sptpl"===r.name?t=r.name+"="+r.value:(e=e+r.name+"="+r.value,o+1<n.length&&(e+="&")))})),t&&(e=e+"&"+t);let o=SobiPro.jQuery("#spctrl-selected-sid").val();e==l&&o!=SobiPro.jQuery("#spctrl-section").val()&&(e=e+"sid="+o),SobiProSelectedUrl=e,SPUpdateUrl()}t&&(t.value=btoa(JSON.stringify(i)))})),e.find(".spctrl-clear").click((function(e){SobiProSelectedUrl="",SPUpdateUrl(),SobiPro.jQuery("#spctrl-selected-function").html(spStrings.buttonLabel)})),SobiPro.jQuery("#spctrl-selector").bind("click",(function(t){if("0"===SobiPro.jQuery("#spctrl-section").val()||""===SobiPro.jQuery("#spctrl-section").val())return SobiPro.Alert("YOU_HAVE_TO_AT_LEAST_SELECT_A_SECTION"),!1;new bootstrap.Modal(document.getElementById("spctrl-modal")).show();let o=SobiPro.jQuery("#spctrl-selector").data("mid"),r=SobiPro.jQuery("#spctrl-section").val();e.find(".modal-body").html('<iframe src="index.php?option=com_sobipro&section='+r+"&task=menu&tmpl=component&format=html&mid="+o+'" class="dk-frame"> </iframe>')}));try{try{let e=Joomla.submitbutton;Joomla.submitbutton=function(t,o){(-1==t.indexOf("save").indexOf||-1==t.indexOf("apply")||SPValidate())&&e(t,o)}}catch(e){let t=submitbutton;submitbutton=function(e,o){(-1==e.indexOf("save").indexOf||-1==e.indexOf("apply")||SPValidate())&&t(e,o)}}}catch(e){}SobiPro.jQuery("#spctrl-functions").change((function(){SobiPro.jQuery(this).val()&&SobiPro.jQuery(".SobiPro").submit()})),SobiPro.jQuery(".spctrl-calendar").change((function(){"use strict";let e=[];SobiPro.jQuery(".spctrl-calendar").each((function(t,o){SobiPro.jQuery(this).val()&&e.push(SobiPro.jQuery(this).val())})),SobiPro.jQuery("[name=request\\[date\\]]").val(e.join("."))})),SobiPro.jQuery(".spctrl-entry-chooser").typeahead({theme:"bs5",property:"name",fitToElement:!0,source:function(e,t){const o={option:"com_sobipro",task:"entry.search",sid:SobiPro.jQuery("#SP_section").val(),search:e,format:"raw"};return SobiPro.jQuery.ajax({type:"post",url:"index.php",data:o,dataType:"json",success:function(e){let o=[];if(e.length){for(let t=0;t<e.length;t++)o[t]={name:e[t].name+" ( "+e[t].id+" )",id:e[t].id,title:e[t].name};t(o)}}})},updater:function(e){return SobiPro.jQuery("#SP_sid").val(e.id),SobiPro.jQuery("#spctrl-selected-entry-name").val(e.title),SobiPro.jQuery("input[name=function-name]").val(SobiPro.jQuery("#spctrl-entry-name").html().replace("%s",e.title)),e.name}});try{SobiPro.jQuery(SobiPro.jQuery("#jform_type-lbl").siblings()[0]).val(spStrings.component)}catch(e){}try{let e=SobiPro.jQuery('[name*="jform[type]"]').parent().find("input[type=text]");e.val(spStrings.component),e.css("min-width","200px")}catch(e){}}));