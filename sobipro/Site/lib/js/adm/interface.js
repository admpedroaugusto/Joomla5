/**
 * @package SobiPro Library
 *
 * @author
 * Name: Sigrid Suski & Radek Suski, Sigsiu.NET GmbH
 * Email: sobi[at]sigsiu.net
 * Url: https://www.Sigsiu.NET
 *
 * @copyright Copyright (C) 2006 - 2023 Sigsiu.NET GmbH (https://www.sigsiu.net). All rights reserved.
 * @license GNU/LGPL Version 3
 * This program is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License version 3
 * as published by the Free Software Foundation, and under the additional terms according section 7 of GPL v3.
 * See https://www.gnu.org/licenses/lgpl.html and https://www.sigsiu.net/licenses.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
 *
 * @created 16 August 2012 by Radek Suski
 * @modified 15 September 2023 by Sigrid Suski
 */
SobiCore.Ready((function(){let e=SobiCore.Query("#SobiPro"),t=SobiCore.Query("#sidebar-wrapper");if(t){SobiCore.Query("#spctrl-jsidebar-btn")&&t.classList.add("collapse")}function r(t){let r=SobiCore.Query("#spctrl-spinner");r&&(t?(e.style.opacity=.3,e.parentNode.insertBefore(r,e),r.classList.remove("hidden")):(e.style.opacity=1,r.classList.add("hidden")))}let o=window.location.hash;if(window.location&&o){let e=spOpenTab(o);e&&spScrollTo(e,!1,!0)}else{let e=localStorage.getItem("SobiProOpenTab");try{e&&(spOpenTab(e),SobiPro.jQuery.each(Joomla.editors.instances,(function(e,t){t.refresh()})),a("#fmn-categories-fields"===e?"category":"entry"))}catch(e){}}let s=[].slice.call(document.querySelectorAll("ul.nav-tabs > li > a"));function a(e){document.querySelectorAll(".btn-toolbar .spctrl-newfield")[0].parentNode.style.display="category"===e?"none":"flex",document.querySelectorAll(".btn-toolbar .spctrl-newfield")[1].parentNode.style.display="category"===e?"flex":"none"}s&&s.forEach((function(e){e.addEventListener("shown.bs.tab",(e=>{try{localStorage.setItem("SobiProOpenTab",e.target.getAttribute("href"))}catch(e){}}))}));let i=document.querySelector('a[href="#fmn-categories-fields" ]'),n=document.querySelector('a[href="#fmn-entry-fields" ]');function l(e){let t=[],r=this;this.counter=0,this.doneCounter=0,this.progressBar=SobiCore.Query("#spctrl-progress").querySelector(".progress-bar"),this.progressMessage=SobiCore.Query("#spctrl-progress .alert"),this.messages={warning:[],error:[],info:[],success:[]},this.finish=function(e){const t={option:"com_sobipro",task:"txt.messages",format:"raw",method:"xhr",spsid:SobiCore.Query("#SP_spsid").value};SobiPro.jQuery.ajax({url:"index.php",data:t,type:"post",dataType:"json",success:function(t){if(t&&t.data.messages.length)for(let e=0;e<t.data.messages.length;e++)r.messages[t.data.messages[e].type].push(t.data.messages[e].text);let o=0,s=[];if(r.messages.length&&r.messages.forEach((function(e,t){let r=[];for(let e=0;e<t.length;e++)o++,r.push("<div><strong> "+o+")&nbsp;</strong>"+t[e]+"</div>");r.length&&s.push('<div class="alert alert-'+e+' alert-sm">'+r.join("\n")+"</div>")})),o>0){let t='<div class="modal hidden" id="sp-modal-msg"><div class="modal-dialog"><div class="modal-content"><div class="modal-body">'+s.join("\n")+'</div><div class="modal-footer"><button type="button" href="#" class="btn btn-primary" data-bs-dismiss="modal">OK</button></div></div></div></div>';SobiPro.jQuery(t).appendTo(SobiPro.jQuery("#SobiPro")),SobiPro.jQuery("#sp-modal-msg").modal().addEventListener("hidden",(()=>{r.refresh(e)}))}else r.refresh(e)}})},this.progress=function(e){this.doneCounter++,this.progressBar.setAttribute("aria-valuenow",100/(this.counter-this.doneCounter+1)),this.progressBar.style.width=100/(this.counter-this.doneCounter+1)+"%",this.messageType(e.message.type),this.progressMessage.innerHTML=e.message.text;let t=e.redirect.url;"success"!=e.message.type&&this.messages[e.message.type].push(e.message.text),this.doneCounter==this.counter&&this.finish(t)},this.refresh=function(e){this.messageType("info"),this.progressMessage.innerHTML=SobiPro.Txt("PROGRESS_DONE_REDIRECTING"),window.location.replace(e)},this.messageType=function(e){this.progressMessage.classList.remove("alert","alert-info","alert-success","alert-danger","alert-error"),this.progressMessage.classList.add("alert","alert-"+e)},SobiPro.jQuery('[name="e_sid[]"]').each((function(e,r){let o=SobiPro.jQuery(r);o.prop("checked")&&t.push(o)}));const o={option:"com_sobipro",task:e,format:"raw",method:"xhr",spsid:SobiPro.jQuery("#SP_spsid").val()};if(t.length){this.counter=t.length,this.progressMessage.innerHTML=SobiPro.Txt("PROGRESS_WORKING"),SobiCore.Query("#spctrl-progress").classList.remove("hidden"),this.progressBar.setAttribute("aria-valuenow",0),this.progressBar.style.width="0%";for(let e=0;e<t.length;e++)o.sid=t[e].val(),SobiPro.jQuery.ajax({url:"index.php",data:o,type:"post",dataType:"json",success:function(e){r.progress(e)}})}else o[SobiPro.jQuery("#SP_task").next().attr("name")]=1,o.sid=SobiPro.jQuery("#SP_pid").val(),o.method="xhr",SobiPro.jQuery.ajax({url:"index.php",data:o,type:"post",dataType:"json",success:function(e){SobiCore.Query("#spctrl-progress").classList.remove("hidden"),r.counter=e.data.counter,r.progress(e),SobiPro.jQuery.each(e.data.entries,(function(e,t){o.eid=t,SobiPro.jQuery.ajax({url:"index.php",data:o,type:"post",dataType:"json",success:function(e){r.progress(e)}})}))}})}i&&i.addEventListener("click",(()=>{a("category")})),n&&n.addEventListener("click",(()=>{a("entry")})),SobiPro.jQuery("input:file").change((function(){SobiPro.jQuery(this).val()}));let c=0,d=["entry.publish","entry.hide","entry.approve","entry.unapprove","entry.deleteAll"];SobiPro.jQuery("#spctrl-adm-toolbar a").click((function(e){let t=this.getAttribute("data-sp-confirm");if(t&&!confirm(t))return e.preventDefault(),e.stopPropagation(),!1;let o=this.getAttribute("rel");SobiCore.Query("#SP_task").value=o;let s=SobiCore.Query("#SP_method");if(null!=o&&o.length){if(e.preventDefault(),e.stopPropagation(),-1!==SobiCore.InArray(o,d)){let e=this.closest(".dropdown");if(e){bootstrap.Dropdown.getInstance(e.querySelector(".dropdown-toggle")).hide()}return new l(o)}if(s&&"xhr"===s.value){let e=document.getElementById("SP_history-behaviour"),t=document.getElementById("SP_history-note");t&&e&&(("entry.save"===o||"entry.apply"===o)&&"1"===e.value||"entry.saveWithRevision"===o?t.value=prompt(SobiPro.Txt("HISTORY_NOTE"),t.value):t.value="");let s={takeOver:!1};SobiPro.jQuery("#SPAdminForm").trigger("BeforeAjaxSubmit",[s,o]);let a=document.getElementById("SPAdminForm");if(a&&a.dispatchEvent(new CustomEvent("BeforeAxSubmit",{bubbles:!0,detail:{handler:s,task:o}})),1==s.takeOver)return!0;!function(){try{let e=Object.keys(tinyMCE.editors);SobiPro.jQuery.each(e,(function(e,t){0!=t&&(tinyMCE.execCommand("mceToggleEditor",!1,t),tinyMCE.execCommand("mceToggleEditor",!1,t))}))}catch(e){}let e=["unload","onbeforeunload","onunload"];for(let t=0;t<e.length;t++){try{window.dispatchEvent(e[t])}catch(e){}try{window.fireEvent(e[t])}catch(e){}try{SobiPro.jQuery(document).triggerHandler(e[t])}catch(e){}try{SobiPro.jQuery.each(CKEDITOR.instances,(function(e,t){t.destroy(),CKEDITOR.replace(e)}))}catch(e){}}try{tinyMCE.triggerSave()}catch(e){}"undefined"!=typeof Joomla&&void 0!==Joomla.editors&&SobiPro.jQuery.each(Joomla.editors.instances,(function(){try{this.save()}catch(e){}}))}();let i=SobiPro.jQuery("#SPAdminForm").serialize();SobiPro.jQuery(SobiPro.jQuery("#SPAdminForm").find(":button")).each((function(e,t){let r=t;"disabled"===r.getAttribute("disabled")||!r.classList.contains("active")&&"active"!==r.getAttribute("data-spctrl-state")||(i+="&"+r.getAttribute("name")+"="+r.value)})),r(!0),SobiPro.jQuery.ajax({url:"index.php",data:i,type:"post",dataType:"json",success:function(e){if(e.redirect.execute)window.location.replace(e.redirect.url);else{let t={takeOver:!1};if(SobiPro.jQuery("#SPAdminForm").trigger("AfterAjaxSubmit",[t,e]),1==t.takeOver)return!0;r(!1),c++;let o="";c>1&&(o="&nbsp;("+c+")");let s='<div class="alert alert-'+e.message.type+' alert-dismissible">'+e.message.text+o+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>',a=SobiCore.Query("#spctrl-message");s&&(a.innerHTML=s);try{SobiPro.jQuery.each(e.data.sets,(function(e,t){SobiPro.jQuery('[name^="'+e+'"]').val(t)}))}catch(e){}let i=null;e.data.required&&"string"!=typeof e.data.required&&(SobiPro.jQuery.each(e.data.required,(function(e,t){let r=SobiPro.jQuery("#"+e+"-message");if(r.length){let o=SobiPro.jQuery("#"+e+"_list");if(o.length||(o=SobiPro.jQuery("#"+e)),o.hasClass("spctrl-validateselectgroup")){let e=[].slice.call(o[0].getElementsByTagName("select"));e.length&&e.forEach((e=>{e.classList.add("is-invalid")}))}else o.hasClass("spctrl-validategroup")?SobiPro.jQuery("[id^="+e+"_option-]").each((function(e){SobiPro.jQuery(this).addClass("is-invalid")})):o.addClass("is-invalid");o.attr("aria-describedby",e+"-message"),o.change((function(){if(SobiPro.jQuery(this).removeClass("is-invalid").attr("aria-describedby",""),o.hasClass("spctrl-validategroup")&&SobiPro.jQuery("[id^="+e+"_option-]").each((function(e){SobiPro.jQuery(this).removeClass("is-invalid").attr("aria-describedby","")})),o.hasClass("spctrl-validateselectgroup")){let e=[].slice.call(o[0].getElementsByTagName("select"));e.length&&e.forEach((e=>{e.classList.remove("is-invalid")}))}SobiPro.jQuery("#"+e+"-message").css("display","none").text("")})),i||(i=o[0]),r.html(SobiPro.jQuery("<span>"+t+"</span>")),SobiPro.jQuery("#"+e+"-message").css("display","block")}})),i&&"password"!==i.getAttribute("type")&&(spOpenTab("#en-base-data"),spScrollTo(i)))}}})}else"field.copy"===o?SobiCore.Query("#spctrl-progress-copy").classList.remove("hidden"):"field.copyto"===o.substring(0,12)&&SobiCore.Query("#spctrl-progress-copyto").classList.remove("hidden"),SobiPro.jQuery("#SPAdminForm").submit()}})),SobiPro.jQuery('[name="spToggle"]').change((function(){SobiPro.jQuery(this).parent().parent().parent().parent().parent().find('[name="'+SobiPro.jQuery(this).attr("rel")+'[]"]').prop("checked",SobiPro.jQuery(this).is(":checked"))})),SobiPro.jQuery('[name="spReorder"]').click((function(e){e.preventDefault(),SobiPro.jQuery("#SP_task").val(SobiPro.jQuery(this).attr("rel")+".reorder"),SobiPro.jQuery("#SPAdminForm").submit()}));try{SobiPro.jQuery(".spctrl-counter-reset").each((function(e,t){"use strict";let r=SobiPro.jQuery(t);0==r.html()&&r.attr("disabled","disabled")}))}catch(e){}let u=SobiCore.QueryAll("a[rel=sp-popover]");u&&u.forEach((e=>{"click"===e.dataset.bsTrigger&&e.addEventListener("click",(e=>{e.preventDefault()}))}));let b=SobiCore.Query(".spctrl-counter-reset");b&&b.addEventListener("click",(e=>{let t=SobiPro.jQuery(e.currentTarget),r=SobiPro.jQuery("#SP_sid").val()?SobiPro.jQuery("#SP_sid").val():SobiPro.jQuery('[name^="category.id"]').val();t.html()?SobiPro.jQuery.ajax({type:"post",url:SobiProAdmUrl.replace("%task%",t.attr("rel")+".resetCounter"),data:{sid:r,format:"raw"},dataType:"json",success:function(){t.html(0),t.attr("disabled","disabled")}}):t.attr("disabled","disabled")})),SobiPro.jQuery('[data-spctrl="ordering"]').keydown((function(e){"use strict";13==e.keyCode&&(e.preventDefault(),e.stopPropagation(),SobiPro.jQuery("#SPAdminForm").submit())})),SobiPro.jQuery('[data-spctrl="disable-enter"]').keydown((function(e){"use strict";13===e.keyCode&&(e.preventDefault(),e.stopPropagation())})),SobiPro.jQuery(".toggle-button :button").each((function(e,t){let r=SobiPro.jQuery(t);r.click((function(){SobiPro.jQuery(r).parent().parent().find(":button").removeClass("btn-no").removeClass("btn-yes").attr("data-spctrl-state","").addClass("btn-unchecked");let e=parseInt(SobiPro.jQuery(this).val());switch(e){case 0:r.addClass("btn-no").removeClass("btn-unchecked"),r.attr("data-spctrl-state","active");break;case 1:r.addClass("btn-yes").removeClass("btn-unchecked"),r.attr("data-spctrl-state","active")}r.parent().attr("data-spctrl-active",e)}))})),SobiPro.jQuery(".tristate-button :button").each((function(e,t){let r=SobiPro.jQuery(t);r.click((function(){SobiPro.jQuery(r).parent().parent().find(":button").removeClass("btn-no").removeClass("btn-yes").removeClass("btn-global").attr("data-spctrl-state","").addClass("btn-unchecked");let e=parseInt(SobiPro.jQuery(this).val());switch(e){case 0:r.addClass("btn-no").removeClass("btn-unchecked"),r.attr("data-spctrl-state","active");break;case 1:r.addClass("btn-yes").removeClass("btn-unchecked"),r.attr("data-spctrl-state","active");break;case 2:r.addClass("btn-global").removeClass("btn-unchecked"),r.attr("data-spctrl-state","active")}r.parent().attr("data-spctrl-active",e)}))}));try{SobiPro.jQuery("#spcfg-general-show-pb").click((function(){1==SobiPro.jQuery(this).find(".active").val()&&SobiPro.Alert("PBY_NO")}))}catch(e){}try{SobiPro.jQuery("#spcfg-debug-xml-ip").click((function(){""==SobiPro.jQuery(this).val()&&SobiPro.jQuery(this).val(SobiPro.jQuery("#SP_current-ip").val())}))}catch(e){}SobiPro.jQuery(".spctrl-file-upload").length&&SobiPro.jQuery(".spctrl-file-upload").SPFileUploader(),function e(){jQuery.ajax({url:"index.php"}),setTimeout(e,3e5)}(),SobiPro.jQuery(".spctrl-default-ordering").click((function(e){e.preventDefault(),confirm(SobiPro.Txt("STORE_DEFAULT_ORDERING"))&&SobiPro.jQuery.ajax({type:"post",url:"index.php",data:{sid:SobiProSection,format:"raw",option:"com_sobipro",tmpl:"component",task:"config.saveOrdering",target:SobiPro.jQuery(this).data("target"),method:"xhr"}}).done((function(e){let t='<div class="alert alert-'+e.message.type+' alert-dismissible"><a class="btn-close" data-bs-dismiss="alert" href="#"></a>'+e.message.text+"</div>";SobiPro.jQuery("#spctrl-message").html(t)}))})),SobiPro.jQuery(window).keydown((function(e){if(224==e.which||17==e.which||91==e.which||93==e.which)SobiPro.cmdKey=!0;else{if((115==e.which||19==e.which||83==e.keyCode)&&(e.ctrlKey||e.cmdKey||SobiPro.cmdKey)){e.preventDefault();try{e.preventDefault(),SobiPro.jQuery(".btn-toolbar").find('[rel*=".apply"]').length?SobiPro.jQuery(".btn-toolbar").find('[rel*=".apply"]').click():SobiPro.jQuery(".btn-toolbar").find('[rel*=".saveConfig"]').length?SobiPro.jQuery(".btn-toolbar").find('[rel*=".saveConfig"]').click():SobiPro.jQuery(".btn-toolbar").find('[rel$=".save"]').click()}catch(e){}}SobiPro.cmdKey=!1}}));try{"active"===SobiPro.jQuery('[name="category.allFields"]').attr("data-spctrl-state")&&SobiPro.jQuery(".spctrl-entry-fields").fadeTo("slow",.2),SobiPro.jQuery('[value="0"][name="category.allFields"]').click((function(){SobiPro.jQuery(".spctrl-entry-fields").fadeTo("slow",1)})),SobiPro.jQuery('[value="1"][name="category.allFields"]').click((function(){SobiPro.jQuery(".spctrl-entry-fields").fadeTo("slow",.2)}))}catch(e){}try{SobiPro.jQuery('[name="field.encryptData"]').click((function(){1==SobiPro.jQuery(this).attr("value")?(SobiPro.jQuery("#fmn-field-search").css("opacity",.3),SobiPro.jQuery('[name="field.inSearch"][value="0"]').click()):SobiPro.jQuery("#fmn-field-search").css("opacity",1)})),SobiCore.Ready((function(){(SobiPro.jQuery('[name="field.encryptData"][value="1"]').hasClass("active")||"active"==SobiPro.jQuery('[name="field.encryptData"][value="1"]').attr("data-spctrl-state"))&&SobiPro.jQuery('[name="field.encryptData"][value="1"]').click()}))}catch(e){}this.TriggerMapsResize=function(){if("undefined"!=typeof SPGeoMapsReg){SobiPro.jQuery(window).trigger("resize");try{for(const e in SPGeoMapsReg){const t=SPGeoMapsReg[e];try{t.Map.setCenter(t.Position)}catch(e){try{L.Util.requestAnimFrame(t.Map.invalidateSize,t.Map,!1,t.Map._container)}catch(e){SobiPro.DebOut(e)}}}}catch(e){SobiPro.DebOut(e)}}};const p=this;let y=SobiCore.Query('a[href="#cat-category-custom-fields"]');y&&y.addEventListener("shown.bs.tab",(()=>{p.TriggerMapsResize()})),y=SobiCore.Query('a[href="#en-base-data"]'),y&&y.addEventListener("shown.bs.tab",(()=>{p.TriggerMapsResize()}));let h=SobiCore.Query("#SPRightMenu");if(h){h.setAttribute("id","spctrl-menu"),h.classList.remove("span3"),h.classList.add("col-lg-3");let e=SobiPro.jQuery(".SobiPro[data-sp-task]");if("template.settings"===e.data("sp-task")){let t=e.find(".row-fluid").first();t.addClass("row").removeClass("row-fluid"),t.children(".span9").removeClass("spMainArea").addClass("sp-main-area").removeClass("span9").addClass("col-lg-9");let r=SobiCore.Query(".alert");r&&(r.setAttribute("id","spctrl-message"),r.classList.remove("alert"))}}})),SobiCore.Ready((()=>{SobiCore.Els("submit")&&SobiCore.Els("submit").forEach((e=>{e.change((()=>{SobiCore.El("form").submit()}))}))}));