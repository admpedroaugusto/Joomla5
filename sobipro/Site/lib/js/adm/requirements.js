/**
 * @package: SobiPro Library
 *
 * @author
 * Name: Sigrid Suski & Radek Suski, Sigsiu.NET GmbH
 * Email: sobi[at]sigsiu.net
 * Url: https://www.Sigsiu.NET
 *
 * @copyright Copyright (C) 2006 - 2021 Sigsiu.NET GmbH (http://www.sigsiu.net). All rights reserved.
 * @license GNU/LGPL Version 3
 * This program is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License version 3
 * as published by the Free Software Foundation, and under the additional terms according section 7 of GPL v3.
 * See https://www.gnu.org/licenses/lgpl.html and https://www.sigsiu.net/licenses.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
 *
 * @modified 15 October 2021 by Sigrid Suski
 */
let SPStartTime=0,SPErrors=0,SPWarnings=0;function SobiProRequirements(){"use strict";let r=(new Date).getTime();SobiPro.jQuery(' <span id="spctrl-progress"></span>').appendTo(SobiPro.jQuery("#SobiPro").find(".spctrl-checkstatus")),this.elements=SobiPro.jQuery(".dk-output"),this.spinner='<img src="'+SPLiveSite+'media/sobipro/adm/spinner.gif" alt="spinner"/>',this.running=this.elements.length,this.factor=100/this.elements.length,this.progress=0;let e=SobiPro.jQuery("#SP_method").next("input");this.request={option:"com_sobipro",method:"xhr",format:"raw"},this.request[e.attr("name")]=e.val(),SobiPro.jQuery(".spctrl-buttons").addClass("hidden");let o=this;this.setMessage=function(){this.running?SobiPro.jQuery("#spctrl-progress").html(SobiPro.Txt("REQUIREMENT_WORKING_MSG").replace("%d",this.running)):(SobiPro.jQuery(".spctrl-buttons").removeClass("hidden"),SobiPro.jQuery("#spctrl-progress").html(SobiPro.Txt("Done")),SPErrors?SobiPro.Alert("REQUIREMENT_ERR"):SPWarnings&&(SobiPro.Alert("REQUIREMENT_WARN"),r=(new Date).getTime()),SobiPro.jQuery("#spctrl-spinner").addClass("hidden")),SobiPro.jQuery("#SobiPro").find(".progress-bar").attr("aria-valuenow",o.progress.toFixed(0)).css("width",o.progress+"%").html(o.progress.toFixed(0)+"%")},this.setMessage(),this.getResponse=function(r,e){let t=SobiPro.jQuery(r),s=o.request;s.task="requirements."+t.attr("id"),t.html(this.spinner),SobiPro.jQuery.ajax({type:"post",url:"index.php",data:s,dataType:"json"}).done((function(r){"warning"==r.type&&SPWarnings++,"error"==r.type&&(r.type="danger",SPErrors++);t.html('<span class="badge bg-'+r.type+'">&nbsp;<span class="fas fa-'+{danger:"thumbs-down",success:"thumbs-up",warning:"hand-point-right"}[r.type]+'" aria-hidden="true"></span>&nbsp;&nbsp;'+r.textType+"</span>&nbsp;&nbsp;"+r.message),o.running--,o.progress+=o.factor,o.setMessage()})).fail((function(s,i){"timeout"==i?e<20?(t.html("<p>No answer. Waiting!</p>"),o.getResponse(r,e++)):(t.html("<p>Too long no answer. Limit expired. Skipping!</p>"),o.running--,o.progress+=o.factor,o.setMessage()):(t.html('<p>Error "'+i+'" occurred. Skipping!</p>'),o.running--,o.progress+=o.factor,o.setMessage())}))},SobiPro.jQuery.each(this.elements,(function(r,e){e=SobiPro.jQuery(e).find("div"),o.getResponse(e,0)}))}SobiPro.jQuery().ready((function(){"use strict";new SobiProRequirements,SobiPro.jQuery("#SobiPro").find(".spctrl-repeat").click((function(){SobiPro.jQuery("#SobiPro").find(".progress-bar").attr("aria-valuenow",0).css("width","0%"),setTimeout((function(){new SobiProRequirements}),1e3)})),SobiPro.jQuery("#SobiPro").find(".spctrl-download").click((function(){document.location=SobiProAdmUrl.replace("%task%","requirements.download")+"&format=raw"})),SobiPro.jQuery("#SobiPro").find(".spctrl-next").click((function(){try{window.top.location.href=SobiPro.jQuery("#SP_redirect").val()}catch(r){}return document.location=SobiPro.jQuery("#SP_redirect").val(),!1}));let r=SobiPro.jQuery("#SobiPro").find(".spctrl-samples");r.click((function(){let e=SobiPro.jQuery("#SobiPro").find(".spctrl-install-samples"),o=e.html(),t='<p class="mt-1 mb-0 fw-bold">';e.html(o+t+SobiPro.Txt("REQ.INSTALLING_SAMPLES")+"</p>");SobiPro.jQuery.ajax({type:"post",url:"index.php",dataType:"json",data:{option:"com_sobipro",format:"raw",task:"requirements.samples",tmpl:"component",method:"xhr"}}).done((function(s){e.html(s?o+t+SobiPro.Txt("REQ.SAMPLES_SUCCESS")+"</p>":o+t+SobiPro.Txt("REQ.SAMPLES_ERROR")+"</p>"),r.addClass("hidden")}))}))}));