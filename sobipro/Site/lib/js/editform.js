/**
 * @package SobiPro Library
 *
 * @author
 * Name: Sigrid Suski & Radek Suski, Sigsiu.NET GmbH
 * Url: https://www.Sigsiu.NET
 *
 * @copyright Copyright (C) 2006â€“2024 Sigsiu.NET GmbH (https://www.sigsiu.net). All rights reserved.
 * @license GNU/LGPL Version 3
 * This program is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License version 3
 * as published by the Free Software Foundation, and under the additional terms according section 7 of GPL v3.
 * See https://www.gnu.org/licenses/lgpl.html and https://www.sigsiu.net/licenses.

 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
 *
 * This is the default JavaScript for the edit screen for SobiPro 2.0. It requires a default or default based frontend template (default7+)
 *
 * @created 15 June 2021 by Sigrid Suski
 * @modified 30 April 2024 by Sigrid Suski
 */
function SPTriggerFrakingWYSIWYGEditors(){try{let e=Object.keys(tinyMCE.editors);SobiPro.jQuery.each(e,(function(e,t){0!=t&&(tinyMCE.execCommand("mceToggleEditor",!1,t),tinyMCE.execCommand("mceToggleEditor",!1,t))}))}catch(e){}let e=["unload","onbeforeunload","onunload"];for(let t=0;t<e.length;t++){try{window.dispatchEvent(e[t])}catch(e){}try{window.fireEvent(e[t])}catch(e){}try{SobiPro.jQuery(document).triggerHandler(e[t])}catch(e){}try{SobiPro.jQuery.each(CKEDITOR.instances,(function(e,t){t.destroy(),CKEDITOR.replace(e)}))}catch(e){}}try{tinyMCE.triggerSave()}catch(e){}try{SobiPro.jQuery.each(Joomla.editors.instances,(function(){this.save()}))}catch(e){}}function SPTriggerSpinner(){}SobiCore.Ready((()=>{let e;if(e=bs>=4?'<div class="SobiPro popover" role="tooltip"><div class="arrow popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>':'<div class="SobiPro popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div>',5===bs){[].slice.call(document.querySelectorAll("a[rel=sp-popover]")).map((function(t){return new bootstrap.Popover(t,{html:!0,trigger:"hover",template:e,animation:!1})}))}else SobiPro.jQuery("a[rel=sp-popover]").popover({html:!0,trigger:"hover",template:e,animation:!1});let t=SobiCore.QueryAll("a[rel=sp-popover]");function i(){"use strict";this.boxes=SobiCore.QueryAll(".spctrl-payment-box");let e=document.querySelector(".spctrl-submit");e&&e.removeAttribute("disabled");let t=this;this.boxes&&this.boxes.forEach((function(e,t){(e=SobiPro.jQuery(e)).targetContainer=SobiPro.jQuery("#"+e.attr("id").replace("-payment","-input-container")),e.toggleTarget=e.targetContainer.children("*").not("option"),e.disable=e.toggleTarget.find('[data-sp-disable="true"]'),0==e.disable.length&&(e.disable=e.toggleTarget.find(".spctrl-sigsiutree-container")),0==e.disable.length&&(e.disable=e.toggleTarget.find("input")),0==e.disable.length&&(e.disable=e.toggleTarget.find("select")),0==e.disable.length&&(e.disable=e.toggleTarget.find("textarea")),e.targetIframes=e.targetContainer.find("iframe").parent(),e.disableTargets=function(){this.disable.attr("disabled","disabled"),this.targetContainer.children().css("opacity","0.5"),this.targetIframes.css("display","none")},e.enableTargets=function(){this.disable.removeAttr("disabled"),this.targetContainer.children().css("opacity","1"),this.targetIframes.css("display","")},e.change((function(){SobiPro.jQuery(this).is(":checked")?e.enableTargets():e.disableTargets()})),1===e.toggleTarget.data("sp-content")?(e.attr("checked",!0),e.enableTargets()):e.disableTargets()})),this.sendRequest=function(){let i=SobiPro.jQuery("#spctrl-entry-form").serialize();SobiPro.jQuery(SobiPro.jQuery("#spctrl-entry-form").find(":button")).each((function(e,t){let r=SobiPro.jQuery(t);(r.hasClass("active")||"active"==r.attr("data-spctrl-state"))&&(i+="&"+r.attr("name")+"="+r.val())})),SobiPro.jQuery.ajax({url:SPLiveSite+"index.php",data:i,type:"post",dataType:"json",success:function(i){if("error"===i.message.type)t.errorHandler(i);else if(1==i.redirect.execute)window.location.replace(SPLiveSite+i.redirect.url);else if("info"===i.message.type){let t;SobiPro.jQuery(i.message.text).appendTo(SobiPro.jQuery("#SobiPro")),e&&e.removeAttribute("disabled");let r=document.getElementById("spctrl-payment-modal");if(r){let e=r.querySelector(".modal");if(e)if(5===bs)t=new bootstrap.Modal(e),t.show(),e.addEventListener("hidden.bs.modal",(e=>{t.dispose(),r.remove()}));else{let t="hidden.bs.modal";2===bs&&(t="hidden"),SobiPro.jQuery(e).modal(),e.addEventListener(t,(t=>{SobiPro.jQuery(e).modal("hide"),r.remove()}))}}}}})},this.dismissAlert=function(e,t,i){e.popover("hidden\t\t\t\tattach.addClass( 'hidden' );\n"),t.addClass("hidden"),e.remove(),i.removeClass("error")},this.errorHandler=function(t){let i=null;e&&e.removeAttribute("disabled"),SobiPro.jQuery.each(t.data.error,(function(e,t){let r=SobiPro.jQuery("#"+e+"-message"),o=document.getElementById(e+"-message");if(r.length){let r=SobiPro.jQuery("#"+e+"_list");if(r.length||(r=SobiPro.jQuery("#"+e)),r.hasClass("spctrl-validateselectgroup")){let e=[].slice.call(r[0].getElementsByTagName("select"));e.length&&e.forEach((e=>{e.classList.add("is-invalid")}))}else r.hasClass("spctrl-validategroup")?bs<4?SobiPro.jQuery("[for^="+e+"_option-]").each((function(e){SobiPro.jQuery(this).addClass("is-invalid")})):SobiPro.jQuery("[id^="+e+"_option-]").each((function(e){SobiPro.jQuery(this).addClass("is-invalid")})):r.addClass("is-invalid");r.attr("aria-describedby",e+"-message"),r.change((function(){if(SobiPro.jQuery(this).removeClass("is-invalid").attr("aria-describedby",""),r.hasClass("spctrl-validategroup")&&(bs<4?SobiPro.jQuery("[for^="+e+"_option-]").each((function(e){SobiPro.jQuery(this).removeClass("is-invalid")})):SobiPro.jQuery("[id^="+e+"_option-]").each((function(e){SobiPro.jQuery(this).removeClass("is-invalid")}))),r.hasClass("spctrl-validateselectgroup")){let e=[].slice.call(r[0].getElementsByTagName("select"));e.length&&e.forEach((e=>{e.classList.remove("is-invalid")}))}SobiPro.jQuery("#"+e+"-container").find(".invalid-feedback").css("display","none").text("")})),i||(i=r[0]),o&&(o.innerHTML="<span>"+t+"</span>",o.style.display="block")}else alert(t)})),i&&"password"!==i.getAttribute("type")&&spScrollTo(i)},e&&e.addEventListener("click",(e=>{SPTriggerSpinner(),SPTriggerFrakingWYSIWYGEditors(),e.target.setAttribute("disabled","disabled"),SobiPro.jQuery(".invalid-feedback").css("display","none").text(""),SobiPro.jQuery(".is-invalid").removeClass("is-invalid").attr("aria-describedby",""),t.sendRequest(),e.preventDefault(),e.stopPropagation()})),SobiPro.jQuery(".spctrl-cancel").click((function(e){SobiPro.jQuery("#SP_task").val("entry.cancel"),t.sendRequest()}))}t&&t.forEach((function(e){e.addEventListener("click",(e=>{e.preventDefault()}))})),setTimeout((function(){new i}),1e3)}));