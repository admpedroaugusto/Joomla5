!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";var i,e=t(window),h=t(document),r=/^(e|n|w|s|ne|nw|sw|se|\*|\+)$/i,a=/^(x|y|width|height)$/i,s="cropper-hidden",n="mouseup mouseleave touchend touchleave touchcancel",d=["build.cropper","built.cropper","dragstart.cropper","dragmove.cropper","dragend.cropper"],o=function(t){return"number"==typeof t},g=function(t){return'<img src="'+t+'">'},c=function(i,e){this.$element=t(i),this.setDefaults(e),this.init()},p=Math.round,l=Math.min,u=Math.max,f=Math.abs,m=parseFloat;c.prototype={constructor:c,setDefaults:function(i){i=t.extend({},c.defaults,t.isPlainObject(i)?i:{}),t.each(i,function(t,e){switch(t){case"aspectRatio":i[t]=f(m(e))||NaN;break;case"minWidth":case"minHeight":i[t]=f(m(e))||0;break;case"maxWidth":case"maxHeight":i[t]=f(m(e))||1/0}}),this.defaults=i},init:function(){var i,e,h=this,r=this.$element,a=r[0],s={};r.is("img")?i=r.attr("src"):r.is("canvas")&&a.getContext&&(i=a.toDataURL()),i&&(this.$clone&&this.$clone.remove(),this.$clone=e=t(g(i)),e.one("load",function(){s.naturalWidth=this.naturalWidth||e.width(),s.naturalHeight=this.naturalHeight||e.height(),s.aspectRatio=s.naturalWidth/s.naturalHeight,h.active=!0,h.src=i,h.image=s,h.build()}),e.addClass("cropper-invisible").prependTo("body"))},build:function(){var i,e,r=this.$element,a=this.defaults;this.built&&this.unbuild(),i=t.Event(d[0]),r.trigger(i),t.isFunction(a.build)&&a.build(i),i.isDefaultPrevented()||(this.$cropper=e=t(c.template),r.addClass(s),this.$clone.removeClass("cropper-invisible").prependTo(e),this.$container=r.parent(),this.$container.append(e),this.$modal=e.find(".cropper-modal"),this.$canvas=e.find(".cropper-canvas"),this.$dragger=e.find(".cropper-dragger"),this.$viewer=e.find(".cropper-viewer"),this.cropped=!0,a.autoCrop||(this.$dragger.addClass(s),this.cropped=!1),this.$modal.toggleClass(s,!a.modal),this.$canvas.toggleClass(s,!a.dragCrop),!a.dashed&&this.$dragger.find(".cropper-dashed").addClass(s),!a.movable&&this.$dragger.find(".cropper-face").addClass(s),!a.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(s),this.$dragScope=a.multiple?this.$cropper:h,this.addListener(),this.initPreview(),this.built=!0,this.update(),r.trigger(d[1]))},unbuild:function(){this.built&&(this.built=!1,this.removeListener(),this.$preview.empty(),this.$preview=null,this.$dragger=null,this.$canvas=null,this.$modal=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},update:function(t){this.initContainer(),this.initCropper(),this.initDragger(),t?this.setData(t,!0):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing),this.resizing=setTimeout(t.proxy(this.update,this,this.getData()),200)},reset:function(t){this.cropped&&(t&&(this.defaults.data={}),this.dragger=this.cloneDragger(),this.setData(this.defaults.data))},release:function(){this.cropped&&(this.cropped=!1,this.defaults.done({x:0,y:0,width:0,height:0}),this.$modal.addClass(s),this.$dragger.addClass(s))},destroy:function(){var t=this.$element;this.active&&(this.unbuild(),t.removeClass(s),t.removeData("cropper"),t=null)},preview:function(){var i=this.cropper,e=this.dragger;this.$viewer.find("img").css({width:p(i.width),height:p(i.height),marginLeft:-p(e.left),marginTop:-p(e.top)}),this.$preview.each(function(){var h=t(this),r=h.width()/e.width,a={width:p(i.width*r),height:p(i.height*r),marginLeft:-p(e.left*r),marginTop:-p(e.top*r)};h.find("img").css(a)})},addListener:function(){var i=this.$element,h=this.defaults;t.each(d,function(e,r){var a=h[d[e].replace(".cropper","")];t.isFunction(a)&&i.on(r,a)}),this.$cropper.on("mousedown touchstart",t.proxy(this.dragstart,this)),this.$dragScope.on("mousemove touchmove",t.proxy(this.dragmove,this)).on(n,t.proxy(this.dragend,this)),e.on("resize.cropper",t.proxy(this.resize,this))},removeListener:function(){var i=this.$element,h=this.defaults;t.each(d,function(e,r){var a=h[d[e].replace(".cropper","")];t.isFunction(a)&&i.off(r,a)}),this.$cropper.off("mousedown touchstart",this.dragstart),this.$dragScope.off("mousemove touchmove",this.dragmove).off(n,this.dragend),e.off("resize.cropper",this.resize)},initPreview:function(){var i=g(this.src);this.$preview=t(this.defaults.preview),this.$preview.html(i),this.$viewer.html(i)},initContainer:function(){var t=this.$container;this.container={width:t.width(),height:t.height()}},initCropper:function(){var t,i=this.container,e=this.image;e.naturalWidth*i.height/e.naturalHeight-i.width>=0?(t={height:i.width/e.aspectRatio,width:i.width,left:0}).top=(i.height-t.height)/2:(t={height:i.height,width:i.height*e.aspectRatio,top:0}).left=(i.width-t.width)/2,e.ratio=t.width/e.naturalWidth,e.height=t.height,e.width=t.width,this.$cropper.css({width:p(t.width),height:p(t.height),left:p(t.left),top:p(t.top)}),this.cropper=t},initDragger:function(){var t,i=this.defaults,e=this.cropper,h=i.aspectRatio||this.image.aspectRatio,r=this.image.ratio;(t=e.height*h-e.width>=0?{height:e.width/h,width:e.width,left:0,top:(e.height-e.width/h)/2,maxWidth:e.width,maxHeight:e.width/h}:{height:e.height,width:e.height*h,left:(e.width-e.height*h)/2,top:0,maxWidth:e.height*h,maxHeight:e.height}).minWidth=0,t.minHeight=0,i.aspectRatio?(isFinite(i.maxWidth)?(t.maxWidth=l(t.maxWidth,i.maxWidth*r),t.maxHeight=t.maxWidth/h):isFinite(i.maxHeight)&&(t.maxHeight=l(t.maxHeight,i.maxHeight*r),t.maxWidth=t.maxHeight*h),i.minWidth>0?(t.minWidth=u(0,i.minWidth*r),t.minHeight=t.minWidth/h):i.minHeight>0&&(t.minHeight=u(0,i.minHeight*r),t.minWidth=t.minHeight*h)):(t.maxWidth=l(t.maxWidth,i.maxWidth*r),t.maxHeight=l(t.maxHeight,i.maxHeight*r),t.minWidth=u(0,i.minWidth*r),t.minHeight=u(0,i.minHeight*r)),t.minWidth=l(t.maxWidth,t.minWidth),t.minHeight=l(t.maxHeight,t.minHeight),t.height*=.8,t.width*=.8,t.left=(e.width-t.width)/2,t.top=(e.height-t.height)/2,t._left=t.left,t._top=t.top,this.defaultDragger=t,this.dragger=this.cloneDragger()},cloneDragger:function(){return t.extend({},this.defaultDragger)},renderDragger:function(){var t=this.dragger,i=this.cropper;t.width>t.maxWidth?(t.width=t.maxWidth,t.left=t._left):t.width<t.minWidth&&(t.width=t.minWidth,t.left=t._left),t.height>t.maxHeight?(t.height=t.maxHeight,t.top=t._top):t.height<t.minHeight&&(t.height=t.minHeight,t.top=t._top),t.left=l(u(t.left,0),i.width-t.width),t.top=l(u(t.top,0),i.height-t.height),t._left=t.left,t._top=t.top,this.dragger=t,this.defaults.done(this.getData()),this.$dragger.css({width:p(t.width),height:p(t.height),left:p(t.left),top:p(t.top)}),this.preview()},setData:function(i,e){var h=this.cropper,r=this.dragger,a=this.defaults.aspectRatio;this.built&&void 0!==i&&((null===i||t.isEmptyObject(i))&&(r=this.cloneDragger()),t.isPlainObject(i)&&!t.isEmptyObject(i)&&(e||(this.defaults.data=i),i=this.transformData(i),o(i.x)&&i.x<=h.width&&(r.left=i.x),o(i.y)&&i.y<=h.height&&(r.top=i.y),a?o(i.width)&&i.width<=r.maxWidth&&i.width>=r.minWidth?(r.width=i.width,r.height=r.width/a):o(i.height)&&i.height<=r.maxHeight&&i.height>=r.minHeight&&(r.height=i.height,r.width=r.height*a):(o(i.width)&&i.width<=r.maxWidth&&i.width>=r.minWidth&&(r.width=i.width),o(i.height)&&i.height<=r.maxHeight&&i.height>=r.minHeight&&(r.height=i.height))),this.dragger=r,this.renderDragger())},getData:function(){var t=this.dragger,i={};return this.built&&(i={x:t.left,y:t.top,width:t.width,height:t.height},i=this.transformData(i,!0)),i},transformData:function(i,e){var h=this.image.ratio,r={};return t.each(i,function(t,i){i=m(i),a.test(t)&&!isNaN(i)&&(r[t]=e?p(i/h):i*h)}),r},setAspectRatio:function(t){var i="auto"===t;t=m(t),(i||!isNaN(t)&&t>0)&&(this.defaults.aspectRatio=i?NaN:t,this.built&&(this.initDragger(),this.renderDragger()))},setImgSrc:function(i){var e,h=this,r=this.$element,a=r[0];i&&i!==this.src&&(r.is("img")?(r.attr("src",i),this.init()):r.is("canvas")&&a.getContext&&(e=a.getContext("2d"),t(g(i)).one("load",function(){a.width=this.width,a.height=this.height,e.clearRect(0,0,a.width,a.height),e.drawImage(this,0,0),h.init()})))},getImgInfo:function(){return this.image||{}},dragstart:function(i){var e,h,a=i.originalEvent.touches,n=i;if(a){if(a.length>1)return;n=a[0]}if(e=t(n.target).data("directive"),r.test(e)){if(i.preventDefault(),h=t.Event(d[2]),this.$element.trigger(h),h.isDefaultPrevented())return;this.directive=e,this.startX=n.pageX,this.startY=n.pageY,"+"===e&&(this.cropping=!0,this.$modal.removeClass(s))}},dragmove:function(i){var e,h=i.originalEvent.touches,r=i;if(h){if(h.length>1)return;r=h[0]}if(this.directive){if(i.preventDefault(),e=t.Event(d[3]),this.$element.trigger(e),e.isDefaultPrevented())return;this.endX=r.pageX,this.endY=r.pageY,this.dragging()}},dragend:function(i){var e;if(this.directive){if(i.preventDefault(),e=t.Event(d[4]),this.$element.trigger(e),e.isDefaultPrevented())return;this.cropping&&(this.cropping=!1,this.$modal.toggleClass(s,!(this.cropped&&this.defaults.modal))),this.directive=""}},dragging:function(){var t,i=this.directive,e=this.cropper,h=e.width,r=e.height,a=this.dragger,n=a.width,d=a.height,o=a.left,g=a.top,c=o+n,p=g+d,l=!0,u=this.defaults.aspectRatio,f={x:this.endX-this.startX,y:this.endY-this.startY};switch(u&&(f.X=f.y*u,f.Y=f.x/u),i){case"+":f.x&&f.y&&(t=this.$cropper.offset(),o=this.startX-t.left,g=this.startY-t.top,n=a.minWidth,d=a.minHeight,f.x>0?f.y>0?i="se":(i="ne",g-=d):f.y>0?(i="sw",o-=n):(i="nw",o-=n,g-=d),this.cropped||(this.cropped=!0,this.$dragger.removeClass(s)));break;case"*":o+=f.x,g+=f.y;break;case"e":if(f.x>=0&&(c>=h||u&&(g<=0||p>=r))){l=!1;break}n+=f.x,u&&(d=n/u,g-=f.Y/2),n<0&&(i="w",n=0);break;case"n":if(f.y<=0&&(g<=0||u&&(o<=0||c>=h))){l=!1;break}d-=f.y,g+=f.y,u&&(n=d*u,o+=f.X/2),d<0&&(i="s",d=0);break;case"w":if(f.x<=0&&(o<=0||u&&(g<=0||p>=r))){l=!1;break}n-=f.x,o+=f.x,u&&(d=n/u,g+=f.Y/2),n<0&&(i="e",n=0);break;case"s":if(f.y>=0&&(p>=r||u&&(o<=0||c>=h))){l=!1;break}d+=f.y,u&&(n=d*u,o-=f.X/2),d<0&&(i="n",d=0);break;case"ne":if(f.y<=0&&(g<=0||c>=h)){l=!1;break}d-=f.y,g+=f.y,u?n=d*u:n+=f.x,d<0&&(i="sw",d=0,n=0);break;case"nw":if(f.y<=0&&(g<=0||o<=0)){l=!1;break}d-=f.y,g+=f.y,u?(n=d*u,o+=f.X):(n-=f.x,o+=f.x),d<0&&(i="se",d=0,n=0);break;case"sw":if(f.x<=0&&(o<=0||p>=r)){l=!1;break}n-=f.x,o+=f.x,u?d=n/u:d+=f.y,n<0&&(i="ne",d=0,n=0);break;case"se":if(f.x>=0&&(c>=h||p>=r)){l=!1;break}n+=f.x,u?d=n/u:d+=f.y,n<0&&(i="nw",d=0,n=0)}l&&(a.width=n,a.height=d,a.left=o,a.top=g,this.directive=i,this.renderDragger()),this.startX=this.endX,this.startY=this.endY}},c.template=(i=(i="div,span,directive,data,point,cropper,class,line,dashed").split(","),'<0 6="5-container"><0 6="5-modal"></0><0 6="5-canvas" 3-2="+"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="*"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>'.replace(/\d+/g,function(t){return i[t]})),c.defaults={aspectRatio:"auto",data:{},done:t.noop,preview:void 0,multiple:!1,autoCrop:!0,dragCrop:!0,dashed:!0,modal:!0,movable:!0,resizable:!0,minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,build:void 0,built:void 0,dragstart:void 0,dragmove:void 0,dragend:void 0},c.setDefaults=function(i){t.extend(c.defaults,i)},c.other=t.fn.cropper,t.fn.cropper=function(i){var e,h=[].slice.call(arguments,1);return this.each(function(){var r,a=t(this),s=a.data("cropper");s||a.data("cropper",s=new c(this,i)),"string"==typeof i&&t.isFunction(r=s[i])&&(e=r.apply(s,h))}),void 0!==e?e:this},t.fn.cropper.constructor=c,t.fn.cropper.setDefaults=c.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=c.other,this}});