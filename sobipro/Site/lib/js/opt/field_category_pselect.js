SobiCore.Ready(function(){SobiPro.jQuery.fn.SPCatInputSelector=function(){let e=this,t=this.data("none")?this.data("none"):"-----",o=!0;this.Categories=[],this.Parents=[],this.Select=this,this.Relations=[],this.Name=this.attr("name"),this.hide(),this.attr("name",""),this.Categories.length||SobiPro.jQuery.ajax({type:"post",url:SobiProUrl.replace("%task%",SobiCore.Query("[data-task]").dataset.task),dataType:"json",data:{sid:SobiProSection,format:"raw",tmpl:"component",method:SobiCore.Query("[data-method]").dataset.method}}).done(function(t){if(SobiPro.jQuery.fn.SPCatInputSelectorCategories=t.categories,e.CreateMap(t.categories,SobiProSection),e.SubSelect(SobiPro.jQuery.fn.SPCatInputSelectorCategories),e.data("selected")>0){let t=[],o=e.data("selected");for(;o!=SobiProSection;){if(t.push(parseInt(o)),!o){o=-1;break}o=e.Parents[o]}t.reverse(),SobiPro.jQuery.each(t,function(t,o){e.Select.val(o),e.Select.trigger("change")})}}),this.CreateMap=function(t,o){SobiPro.jQuery.each(t,function(t,a){e.Parents[a.sid]=o,e.Relations[a.sid]=a,e.CreateMap(a.childs,a.sid)})},this.SubSelect=function(a){if(Object.keys(a).length){let i=e.Select.clone();i.attr("name","").removeAttr("id").find("option").remove().end(),SobiPro.jQuery("<option/>",{value:0,text:t}).appendTo(i),SobiPro.jQuery.each(a,function(e,t){SobiPro.jQuery("<option/>",{value:t.sid,text:t.name}).appendTo(i)}),i.insertAfter(this.Select),o&&(this.Select.replaceWith(""),o=!1),i.show(),this.Select=i,this.Select.change(function(){let t=SobiPro.jQuery(this);t.nextAll("select").length&&(t.nextAll("select").remove(),e.Select=t),0!=t.val()?(t.prevAll("select").length&&t.prevAll("select").attr("name",""),t.attr("name",e.Name)):0==t.val()&&(t.attr("name",""),t.prev("select").attr("name",e.Name)),e.SubSelect(e.Relations[t.val()].childs)})}}},SobiPro.jQuery(".spctrl-field-category").SPCatInputSelector()});