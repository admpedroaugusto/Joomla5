function SigsiuTreeEdit(e){const t=this;this.settings=e,this.canvas=SobiPro.jQuery("#"+this.settings.field+"_canvas"),this.category={},this.options=this.canvas.find(".selected").find("select option"),this.selectField=this.canvas.find(".selected").find("select"),this.tree=this.canvas.find(".spctrl-sigsiutree-container"),this.loading=!1,this.requested=!1,this.addBtn="",this.rel=0,this.getCategoryData=function(e){this.loading=!0,SobiPro.jQuery.ajax({url:"index.php",data:{option:"com_sobipro",task:"category.parents",sid:e,out:"json"},type:"post",dataType:"json",success:function(e){SobiPro.jQuery.each(e.categories,function(e,i){t.category=i}),t.loading=!1}})},this.init=function(){this.canvas.find(".treeNode").click(function(e){if(t.tree.attr("disabled"))e.preventDefault();else{SobiPro.jQuery(this).focus();const i=SobiPro.jQuery(this).attr("rel");t.rel!==i?(t.rel=i,e.preventDefault(),t.getCategoryData(SobiPro.jQuery(this).attr("rel"))):e.preventDefault()}})},this.canvas.find(".spctrl-sigsiutree-container").bind("DOMNodeInserted",function(){t.init()}),this.init(),this.updateSelected=function(){let e=[];this.canvas.find(".selected").find("select option").each(function(t,i){SobiPro.jQuery(i).prop("selected",!0),e.push(SobiPro.jQuery(i).val())}),this.canvas.find(".selected").find("input").val("json://["+e.join(",")+"]")},this.addCategory=function(){const e=this.canvas.find('[name="addCategory"]');let i=!1;if(this.addBtn.length&&(e.html(this.addBtn),e.removeAttr("disabled"),this.addBtn=""),t.loading){this.addBtn=e.html();const i=SobiPro.Ico("spinner")+"&nbsp;&nbsp;";return e.attr("disabled","disabled"),e.html(i+this.addBtn),t.canvas.find(".spctrl-sigsiutree").addClass("spctrl-disabled-area"),setTimeout(function(){t.addCategory()},1e3)}t.category.id||t.tree.attr("disabled")||(SobiPro.Alert("PLEASE_SELECT_CATEGORY_YOU_WANT_TO_ADD_IN_THE_TREE_FIRST"),i=!0),t.settings.preventParents&&t.category.childsCount>0&&(SobiPro.Alert("SELECT_CAT_WITH_NO_CHILDS"),i=!0),this.canvas.find(".selected").find("select option").each(function(e,s){t.category.id==SobiPro.jQuery(s).val()&&(SobiPro.Alert("THIS_CATEGORY_HAS_BEEN_ALREADY_ADDED"),i=!0)}),i||(this.selectField.append(new Option(SobiPro.StripSlashes(this.category.name),this.category.id)),this.canvas.find('[name="removeCategory"]').removeAttr("disabled","disabled"),t.canvas.find(".spctrl-sigsiutree").removeClass("spctrl-disabled-area"),this.canvas.find(".selected").find("select option").length>=this.settings.maxcats&&(this.selectField.attr("readonly","readonly"),e.attr("disabled","disabled")),this.updateSelected(),this.selectField.change())},this.canvas.find('[name="addCategory"]').click(function(){t.addCategory()}),this.canvas.find('[name="removeCategory"]').click(function(){const e=t.selectField.find("option:selected");e.length&&(e.each(function(e,t){SobiPro.jQuery(t).remove()}),t.selectField.removeAttr("readonly","readonly"),t.canvas.find('[name="addCategory"]').removeAttr("disabled","disabled")),t.canvas.find(".selected").find("select option").length||SobiPro.jQuery(this).attr("disabled","disabled"),t.updateSelected()})}