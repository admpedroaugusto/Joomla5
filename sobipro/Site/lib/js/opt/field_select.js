SobiCore.Ready(function(){let e=[].slice.call(document.querySelectorAll(".spctrl-dependency-field"));e&&e.map((e,t)=>{e.addEventListener("change",e=>{!function e(t){let r,a,n=t,o=n.getAttribute("name").replace("_","."),i=n.parentElement.parentElement,d=i.querySelector('input[type="hidden"]'),l={};d.value.length&&(l=JSON.parse(d.value.replace(/\'/g,'"'))),l.length&&l.forEach(function(e){r=e}),i.querySelectorAll('[name="'+n.getAttribute("name")+'"]').forEach((e,t)=>{e.dataset.order>n.dataset.order&&(delete l[e.dataset.order],e.remove())}),l[n.dataset.order]=n.value,d.value=JSON.stringify(l),(a=document.createElement("div")).innerHTML=SobiPro.Ico("spinner-large"),i.appendChild(a),n.style.opacity=.5,SobiPro.jQuery.ajax({url:SPLiveSite+"index.php",data:{sid:d.getAttribute("data-section"),parent:n.value,path:d.value,task:o+".dependency",option:"com_sobipro",format:"raw",tmpl:"component"},type:"post",dataType:"json"}).done(t=>{if(d.value=t.path,a.remove(),n.style.opacity=1,SobiPro.jQuery.makeArray(t.options).length){let r=n.cloneNode(),a=r.getAttribute("id")+"_"+r.dataset.order;r.setAttribute("id",a),r.querySelectorAll("option").forEach(e=>{e.remove()}),SobiPro.jQuery.each(t.options,(e,t)=>{r.append(new Option(t,e))}),r.dataset.order=(parseInt(r.dataset.order)+1).toString(),n.parentNode.insertBefore(r,n.nextSibling),r.addEventListener("change",t=>{e(t.currentTarget)})}})}(e.currentTarget)})})});