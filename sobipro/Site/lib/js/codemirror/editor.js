var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent),webkit=/AppleWebKit/.test(navigator.userAgent),safari=/Apple Computers, Inc/.test(navigator.vendor),gecko=/gecko\/(\d{8})/i.test(navigator.userAgent);function makeWhiteSpace(e){for(var t=[],i=!0;e>0;e--)t.push(i||1==e?nbsp:" "),i=!i;return t.join("")}function fixSpaces(e){return" "==e.charAt(0)&&(e=nbsp+e.slice(1)),e.replace(/\t/g,(function(){return makeWhiteSpace(indentUnit)})).replace(/[ \u00a0]{2,}/g,(function(e){return makeWhiteSpace(e.length)}))}function cleanText(e){return e.replace(/\u00a0/g," ").replace(/\u200b/g,"")}function makePartSpan(e,t){var i=e;3==e.nodeType?i=e.nodeValue:e=t.createTextNode(i);var n=t.createElement("SPAN");return n.isPart=!0,n.appendChild(e),n.currentText=i,n}var webkitLastLineHack=webkit?function(e){var t=e.lastChild;t&&t.isPart&&"​"==t.textContent||e.appendChild(makePartSpan("​",e.ownerDocument))}:function(){},Editor=function(){var e={P:!0,DIV:!0,LI:!0};function t(e){var t=makeWhiteSpace(indentUnit);return map(e.replace(/\t/g,t).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}function i(t){function i(e,t){return r=t,e}function n(e,t,i){return function(){return e(t,i)}}var r=n((function t(r,h){r.nextSibling&&(h=n(t,r.nextSibling,h));if(function(e){if(e.isPart&&1==e.childNodes.length&&3==e.firstChild.nodeType)return e.currentText=e.firstChild.nodeValue,!/[\n\t\r]/.test(e.currentText);return!1}(r))return s.push(r),c=!1,i(r.currentText,h);if(isBR(r))return c&&window.opera&&r.parentNode.insertBefore(makePartSpan("",o),r),s.push(r),c=!0,i("\n",h);var l=!r.nextSibling;return a=function(e){var t=e.parentNode,i=e.nextSibling;return function(e){t.insertBefore(e,i)}}(r),removeElement(r),function(t,n,r){var h=[];return forEach(function(t,i){var n=t.ownerDocument,r=[],o=!0;return function t(s,a){3==s.nodeType?((s.nodeValue=fixSpaces(s.nodeValue.replace(/[\r\u200b]/g,"").replace(/\n/g," "))).length&&(o=!1),r.push(s)):isBR(s)&&0==s.childNodes.length?(o=!0,r.push(s)):(forEach(s.childNodes,t),!o&&e.hasOwnProperty(s.nodeName.toUpperCase())&&(o=!0,i&&a||r.push(n.createElement("BR"))))}(t,!0),r}(t,r),(function(e){h.push(function(e){var t="\n";3==e.nodeType?(select.snapshotChanged(),t=(e=makePartSpan(e,o)).currentText,c=!1):(c&&window.opera&&a(makePartSpan("",o)),c=!0);return e.dirty=!0,s.push(e),a(e),t}(e))})),i(h.join(""),n)}(r,h,l)}),t,(function e(){throw r=e,StopIteration})),o=t.ownerDocument,s=[];var a=null,c=!0;return{next:function(){return r()},nodes:s}}function n(e){for(;e&&!isBR(e);)e=e.previousSibling;return e}function r(e,t){for(e?isBR(e)&&(e=e.nextSibling):e=t.firstChild;e&&!isBR(e);)e=e.nextSibling;return e}function o(){return(new Date).getTime()}function s(e,t,i,n){var r;this.editor=e,this.caseFold=n,n&&(t=t.toLowerCase()),this.history=e.history,this.history.commit(),this.atOccurrence=!1,this.fallbackSize=15,i&&(r=select.cursorPos(this.editor.container))?(this.line=r.node,this.offset=r.offset):(this.line=null,this.offset=0),this.valid=!!t;var o=t.split("\n"),s=this;this.matches=1==o.length?function(){var e=cleanText(s.history.textAfter(s.line).slice(s.offset)),i=(s.caseFold?e.toLowerCase():e).indexOf(t);if(i>-1)return{from:{node:s.line,offset:s.offset+i},to:{node:s.line,offset:s.offset+i+t.length}}}:function(){var e=cleanText(s.history.textAfter(s.line).slice(s.offset)),t=(s.caseFold?e.toLowerCase():e).lastIndexOf(o[0]);if(-1==t||t!=e.length-o[0].length)return!1;for(var i=s.offset+t,n=s.history.nodeAfter(s.line),r=1;r<o.length-1;r++){var a=cleanText(s.history.textAfter(n));if((s.caseFold?a.toLowerCase():a)!=o[r])return!1;n=s.history.nodeAfter(n)}var c=cleanText(s.history.textAfter(n));return 0==(s.caseFold?c.toLowerCase():c).indexOf(o[o.length-1])&&{from:{node:s.line,offset:i},to:{node:n,offset:o[o.length-1].length}}}}function a(e){this.options=e,window.indentUnit=e.indentUnit,this.parent=parent,this.doc=document;var t=this.container=this.doc.body;this.win=window,this.history=new History(t,e.undoDepth,e.undoDelay,this);var i=this;if(!a.Parser)throw"No parser loaded.";if(e.parserConfig&&a.Parser.configure&&a.Parser.configure(e.parserConfig),e.readOnly||select.setCursorPos(t,{node:null,offset:0}),this.dirty=[],this.importCode(e.content||""),this.history.onChange=e.onChange,e.readOnly)e.textWrapping||(t.style.whiteSpace="nowrap");else{function n(){null!=document.body.contentEditable&&internetExplorer?document.body.contentEditable="true":document.designMode="on",document.documentElement.style.borderWidth="0",e.textWrapping||(t.style.whiteSpace="nowrap")}!1!==e.continuousScanning&&(this.scanner=this.documentScanner(e.passTime),this.delayScanning());try{n()}catch(s){var r=addEventHandler(document,"focus",(function(){r(),n()}),!0)}function o(){i.cursorActivity(!1)}addEventHandler(document,"keydown",method(this,"keyDown")),addEventHandler(document,"keypress",method(this,"keyPress")),addEventHandler(document,"keyup",method(this,"keyUp")),addEventHandler(document.body,"mouseup",o),addEventHandler(document.body,"cut",o),gecko&&addEventHandler(this.win,"pagehide",(function(){i.unloaded=!0})),addEventHandler(document.body,"paste",(function(e){o();var t=null;try{var n=e.clipboardData||window.clipboardData;n&&(t=n.getData("Text"))}catch(e){}null!==t&&(e.stop(),i.replaceSelection(t),select.scrollToCursor(i.container))})),this.options.autoMatchParens&&addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"))}}return s.prototype={findNext:function(){if(!this.valid)return!1;this.atOccurrence=!1;var e,t=this;for(this.line&&!this.line.parentNode&&(this.line=null,this.offset=0);;){var i=this.matches();if(i)return this.atOccurrence=i,e=i.from,t.history.textAfter(e.node).length>e.offset?(t.line=e.node,t.offset=e.offset+1):(t.line=t.history.nodeAfter(e.node),t.offset=0),!0;if(this.line=this.history.nodeAfter(this.line),this.offset=0,!this.line)return this.valid=!1,!1}},select:function(){this.atOccurrence&&(select.setCursorPos(this.editor.container,this.atOccurrence.from,this.atOccurrence.to),select.scrollToCursor(this.editor.container))},replace:function(e){if(this.atOccurrence){var t=this.editor.replaceRange(this.atOccurrence.from,this.atOccurrence.to,e);this.line=t.node,this.offset=t.offset,this.atOccurrence=!1}}},a.prototype={importCode:function(e){this.history.push(null,null,t(e)),this.history.reset()},getCode:function(){if(!this.container.firstChild)return"";var e=[];return select.markSelection(this.win),forEach(i(this.container.firstChild),method(e,"push")),webkitLastLineHack(this.container),select.selectMarked(),cleanText(e.join(""))},checkLine:function(e){if(!1===e||null!=e&&e.parentNode!=this.container)throw parent.CodeMirror.InvalidLineHandle},cursorPosition:function(e){null==e&&(e=!0);var t=select.cursorPos(this.container,e);return t?{line:t.node,character:t.offset}:{line:null,character:0}},firstLine:function(){return null},lastLine:function(){return this.container.lastChild?n(this.container.lastChild):null},nextLine:function(e){return this.checkLine(e),r(e,this.container)||!1},prevLine:function(e){return this.checkLine(e),null!=e&&n(e.previousSibling)},visibleLineCount:function(){for(var e=this.container.firstChild;e&&isBR(e);)e=e.nextSibling;if(!e)return!1;var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return Math.floor(t/e.offsetHeight)},selectLines:function(e,t,i,n){this.checkLine(e);var r={node:e,offset:t},o=null;void 0!==n&&(this.checkLine(i),o={node:i,offset:n}),select.setCursorPos(this.container,r,o),select.scrollToCursor(this.container)},lineContent:function(e){var t=[];for(e=e?e.nextSibling:this.container.firstChild;e&&!isBR(e);e=e.nextSibling)t.push(nodeText(e));return cleanText(t.join(""))},setLineContent:function(e,t){this.history.commit(),this.replaceRange({node:e,offset:0},{node:e,offset:this.history.textAfter(e).length},t),this.addDirtyNode(e),this.scheduleHighlight()},removeLine:function(e){for(var t=e?e.nextSibling:this.container.firstChild;t;){var i=t.nextSibling;if(removeElement(t),isBR(t))break;t=i}this.addDirtyNode(e),this.scheduleHighlight()},insertIntoLine:function(e,i,n){var o=null;if("end"==i)o=r(e,this.container);else for(var s=e?e.nextSibling:this.container.firstChild;s;s=s.nextSibling){if(0==i){o=s;break}var a=nodeText(s);if(a.length>i){o=s.nextSibling,n=a.slice(0,i)+n+a.slice(i),removeElement(s);break}i-=a.length}for(var c=t(n),h=this.container.ownerDocument,l=0;l<c.length;l++)l>0&&this.container.insertBefore(h.createElement("BR"),o),this.container.insertBefore(makePartSpan(c[l],h),o);this.addDirtyNode(e),this.scheduleHighlight()},selectedText:function(){var e=this.history;e.commit();var t=select.cursorPos(this.container,!0),i=select.cursorPos(this.container,!1);if(!t||!i)return"";if(t.node==i.node)return e.textAfter(t.node).slice(t.offset,i.offset);for(var n=[e.textAfter(t.node).slice(t.offset)],r=e.nodeAfter(t.node);r!=i.node;r=e.nodeAfter(r))n.push(e.textAfter(r));return n.push(e.textAfter(i.node).slice(0,i.offset)),cleanText(n.join("\n"))},replaceSelection:function(e){this.history.commit();var t=select.cursorPos(this.container,!0),i=select.cursorPos(this.container,!1);t&&i&&(i=this.replaceRange(t,i,e),select.setCursorPos(this.container,i),webkitLastLineHack(this.container))},reroutePasteEvent:function(){if(!this.capturingPaste&&!window.opera){this.capturingPaste=!0;var e=window.frameElement.CodeMirror.textareaHack;parent.focus(),e.value="",e.focus();var t=this;this.parent.setTimeout((function(){t.capturingPaste=!1,t.win.focus(),t.selectionSnapshot&&t.win.select.setBookmark(t.container,t.selectionSnapshot);var i=e.value;i&&(t.replaceSelection(i),select.scrollToCursor(t.container))}),10)}},replaceRange:function(e,i,n){var r=t(n);r[0]=this.history.textAfter(e.node).slice(0,e.offset)+r[0];var o=r[r.length-1];r[r.length-1]=o+this.history.textAfter(i.node).slice(i.offset);var s=this.history.nodeAfter(i.node);return this.history.push(e.node,s,r),{node:this.history.nodeBefore(s),offset:o.length}},getSearchCursor:function(e,t,i){return new s(this,e,t,i)},reindent:function(){this.container.firstChild&&this.indentRegion(null,this.container.lastChild)},reindentSelection:function(e){if(select.somethingSelected(this.win)){var t=select.selectionTopNode(this.container,!0),i=select.selectionTopNode(this.container,!1);if(!1===t||!1===i)return;this.indentRegion(t,i,e)}else this.indentAtCursor(e)},grabKeys:function(e,t){this.frozen=e,this.keyFilter=t},ungrabKeys:function(){this.frozen="leave",this.keyFilter=null},setParser:function(e){a.Parser=window[e],this.container.firstChild&&(forEach(this.container.childNodes,(function(e){3!=e.nodeType&&(e.dirty=!0)})),this.addDirtyNode(this.firstChild),this.scheduleHighlight())},keyDown:function(e){if("leave"==this.frozen&&(this.frozen=null),this.frozen&&(!this.keyFilter||this.keyFilter(e.keyCode,e)))return e.stop(),void this.frozen(e);var t=e.keyCode;if(this.delayScanning(),this.options.autoMatchParens&&this.scheduleParenHighlight(),13==t)e.ctrlKey&&!e.altKey?this.reparseBuffer():(select.insertNewlineAtCursor(this.win),this.indentAtCursor(),select.scrollToCursor(this.container)),e.stop();else if(9!=t||"default"==this.options.tabMode||e.ctrlKey)if(32==t&&e.shiftKey&&"default"==this.options.tabMode)this.handleTab(!0),e.stop();else if(36!=t||e.shiftKey||e.ctrlKey)if(35!=t||e.shiftKey||e.ctrlKey)if(33!=t||e.shiftKey||e.ctrlKey||gecko)if(34!=t||e.shiftKey||e.ctrlKey||gecko)if(219!=t&&221!=t||!e.ctrlKey||e.altKey)if(!e.metaKey||e.shiftKey||37!=t&&39!=t)!e.ctrlKey&&!e.metaKey||e.altKey||(e.shiftKey&&90==t||89==t?(select.scrollToNode(this.history.redo()),e.stop()):90==t||safari&&8==t?(select.scrollToNode(this.history.undo()),e.stop()):83==t&&this.options.saveFunction?(this.options.saveFunction(),e.stop()):internetExplorer&&86==t&&this.reroutePasteEvent());else{var i=select.selectionTopNode(this.container);if(!1===i||!this.container.firstChild)return;if(37==t)select.focusAfterNode(n(i),this.container);else{var o=r(i,this.container);select.focusAfterNode(o?o.previousSibling:this.container.lastChild,this.container)}e.stop()}else this.highlightParens(e.shiftKey,!0),e.stop();else this.pageDown()&&e.stop();else this.pageUp()&&e.stop();else this.end()&&e.stop();else this.home()&&e.stop();else this.handleTab(!e.shiftKey),e.stop()},keyPress:function(e){var t=a.Parser.electricChars,i=this;this.frozen&&(!this.keyFilter||this.keyFilter(e.keyCode,e))||13==e.code||9==e.code&&"default"!=this.options.tabMode||32==e.keyCode&&e.shiftKey&&"default"==this.options.tabMode?e.stop():t&&-1!=t.indexOf(e.character)?this.parent.setTimeout((function(){i.indentAtCursor(null)}),0):"v"!=e.character&&"V"!=e.character||!e.ctrlKey&&!e.metaKey||e.altKey||this.reroutePasteEvent()},keyUp:function(e){var t;this.cursorActivity((t=e.keyCode)>=16&&t<=18||t>=33&&t<=40)},indentLineAfter:function(e,t){var i=e?e.nextSibling:this.container.firstChild;i&&!hasClass(i,"whitespace")&&(i=null);var n=i?i.nextSibling:e?e.nextSibling:this.container.firstChild,r=e&&n&&n.currentText?n.currentText:"",o=0,s=i?i.currentText.length:0;null!=t&&"shift"==this.options.tabMode?o=t?s+indentUnit:Math.max(0,s-indentUnit):e?o=e.indentation(r,s,t):a.Parser.firstIndentation&&(o=a.Parser.firstIndentation(r,s,t));var c=o-s;if(c<0)0==o?(n&&select.snapshotMove(i.firstChild,n.firstChild,0),removeElement(i),i=null):(select.snapshotMove(i.firstChild,i.firstChild,c,!0),i.currentText=makeWhiteSpace(o),i.firstChild.nodeValue=i.currentText);else if(c>0){i?(i.currentText=makeWhiteSpace(o),i.firstChild.nodeValue=i.currentText):((i=makePartSpan(makeWhiteSpace(o),this.doc)).className="whitespace",e?insertAfter(i,e):this.container.insertBefore(i,this.container.firstChild));var h=n&&(n.firstChild||n);select.snapshotMove(h,i.firstChild,o,!1,!0)}0!=c&&this.addDirtyNode(e)},highlightAtCursor:function(){var e=select.selectionTopNode(this.container,!0),t=select.selectionTopNode(this.container,!1);return!1!==e&&!1!==t&&(select.markSelection(this.win),!1!==this.highlight(e,r(t,this.container),!0,20)&&(select.selectMarked(),!0))},handleTab:function(e){"spaces"==this.options.tabMode?select.insertTabAtCursor(this.win):this.reindentSelection(e)},home:function(){var e=select.selectionTopNode(this.container,!0),t=e;if(!1===e||e&&!e.isPart&&!isBR(e)||!this.container.firstChild)return!1;for(;e&&!isBR(e);)e=e.previousSibling;var i=e?e.nextSibling:this.container.firstChild;return i&&i!=t&&i.isPart&&hasClass(i,"whitespace")?select.focusAfterNode(i,this.container):select.focusAfterNode(e,this.container),select.scrollToCursor(this.container),!0},end:function(){var e=select.selectionTopNode(this.container,!0);return!1!==e&&(!!(e=r(e,this.container))&&(select.focusAfterNode(e.previousSibling,this.container),select.scrollToCursor(this.container),!0))},pageUp:function(){var e=this.cursorPosition().line,t=this.visibleLineCount();if(!1===e||!1===t)return!1;t-=2;for(var i=0;i<t&&!1!==(e=this.prevLine(e));i++);return 0!=i&&(select.setCursorPos(this.container,{node:e,offset:0}),select.scrollToCursor(this.container),!0)},pageDown:function(){var e=this.cursorPosition().line,t=this.visibleLineCount();if(!1===e||!1===t)return!1;t-=2;for(var i=0;i<t;i++){var n=this.nextLine(e);if(!1===n)break;e=n}return 0!=i&&(select.setCursorPos(this.container,{node:e,offset:0}),select.scrollToCursor(this.container),!0)},scheduleParenHighlight:function(){this.parenEvent&&this.parent.clearTimeout(this.parenEvent);var e=this;this.parenEvent=this.parent.setTimeout((function(){e.highlightParens()}),300)},highlightParens:function(e,t){var i=this;function n(e,t){e&&(i.options.markParen?i.options.markParen(e,t):(e.style.fontWeight="bold",e.style.color=t?"#8F8":"#F88"))}function o(e){e&&(i.options.unmarkParen?i.options.unmarkParen(e):(e.style.fontWeight="",e.style.color=""))}if(!t&&i.highlighted&&(o(i.highlighted[0]),o(i.highlighted[1])),window.select){this.parenEvent&&this.parent.clearTimeout(this.parenEvent),this.parenEvent=null;var s,a=select.selectionTopNode(this.container,!0);if(a&&this.highlightAtCursor()&&(a=select.selectionTopNode(this.container,!0))&&((s=u(a))||(a=a.nextSibling)&&(s=u(a)))){var c=a.className,h=d(s);for(matching[s];;){var l=f();if("dirty"!=l.status){n(a,l.status),n(l.node,l.status),t?i.parent.setTimeout((function(){o(a),o(l.node)}),500):i.highlighted=[a,l.node],e&&l.node&&select.focusAfterNode(l.node.previousSibling,this.container);break}this.highlight(l.node,r(l.node)),l.node.dirty=!1}}}function u(e){if(e.currentText){var t=e.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return t&&t[1]}}function d(e){return/[\(\[\{]/.test(e)}function f(){for(var e,t=[],i=!0,n=a;n;n=h?n.nextSibling:n.previousSibling)if(n.className==c&&isSpan(n)&&(e=u(n))){if(d(e)==h?t.push(e):t.length?t.pop()!=matching[e]&&(i=!1):i=!1,!t.length)break}else if(n.dirty||!isSpan(n)&&!isBR(n))return{node:n,status:"dirty"};return{node:n,status:n&&i}}},indentAtCursor:function(e){if(this.container.firstChild&&this.highlightAtCursor()){var t=select.selectionTopNode(this.container,!1);!1!==t&&(select.markSelection(this.win),this.indentLineAfter(n(t),e),select.selectMarked())}},indentRegion:function(e,t,i){var o=e=n(e),s=e&&n(e.previousSibling);isBR(t)||(t=r(t,this.container)),this.addDirtyNode(e);do{var a=r(o,this.container);o&&this.highlight(s,a,!0),this.indentLineAfter(o,i),s=o,o=a}while(o!=t);select.setCursorPos(this.container,{node:e,offset:0},{node:t,offset:0})},cursorActivity:function(e){this.unloaded&&(this.win.document.designMode="off",this.win.document.designMode="on",this.unloaded=!1),internetExplorer&&(this.container.createTextRange().execCommand("unlink"),this.selectionSnapshot=select.getBookmark(this.container));var t=this.options.cursorActivity;if(!e||t){var i=select.selectionTopNode(this.container,!1);if(!1===i||!this.container.firstChild)return;i=i||this.container.firstChild,t&&t(i),e||(this.scheduleHighlight(),this.addDirtyNode(i))}},reparseBuffer:function(){forEach(this.container.childNodes,(function(e){e.dirty=!0})),this.container.firstChild&&this.addDirtyNode(this.container.firstChild)},addDirtyNode:function(e){if(e=e||this.container.firstChild){for(var t=0;t<this.dirty.length;t++)if(this.dirty[t]==e)return;3!=e.nodeType&&(e.dirty=!0),this.dirty.push(e)}},allClean:function(){return!this.dirty.length},scheduleHighlight:function(){var e=this;this.parent.clearTimeout(this.highlightTimeout),this.highlightTimeout=this.parent.setTimeout((function(){e.highlightDirty()}),this.options.passDelay)},getDirtyNode:function(){for(;this.dirty.length>0;){var e=this.dirty.pop();try{for(;e&&e.parentNode!=this.container;)e=e.parentNode;if(e&&(e.dirty||3==e.nodeType))return e}catch(e){}}return null},highlightDirty:function(e){if(!window.select)return!1;this.options.readOnly||select.markSelection(this.win);for(var t,i=e?null:o()+this.options.passTime;(o()<i||e)&&(t=this.getDirtyNode());){var n=this.highlight(t,i);n&&n.node&&n.dirty&&this.addDirtyNode(n.node)}return this.options.readOnly||select.selectMarked(),t&&this.scheduleHighlight(),0==this.dirty.length},documentScanner:function(e){var t=this,i=null;return function(){if(window.select){i&&i.parentNode!=t.container&&(i=null),select.markSelection(t.win);var n=t.highlight(i,o()+e,!0);select.selectMarked();var r=n?n.node&&n.node.nextSibling:null;i=i==r?null:r,t.delayScanning()}}},delayScanning:function(){this.scanner&&(this.parent.clearTimeout(this.documentScan),this.documentScan=this.parent.setTimeout(this.scanner,this.options.continuousScanning))},highlight:function(e,t,n,r){var s=this.container,c=this,h=this.options.activeTokens,l="number"==typeof t?t:null;if(!s.firstChild)return!1;for(;e&&(!e.parserFromHere||e.dirty);){if(null!=r&&isBR(e)&&--r<0)return!1;e=e.previousSibling}if(e&&!e.nextSibling)return!1;function u(e,t){e.currentText=e.currentText.substring(t),e.reduced=!0}function d(e){if(e){var t=e.oldNextSibling;(y||void 0===t||e.nextSibling!=t)&&c.history.touch(e),e.oldNextSibling=e.nextSibling}else{t=c.container.oldFirstChild;(y||void 0===t||c.container.firstChild!=t)&&c.history.touch(null),c.container.oldFirstChild=c.container.firstChild}}var f=i(e?e.nextSibling:s.firstChild),p=stringStream(f),g=e?e.parserFromHere(p):a.Parser.make(p);var v={current:null,get:function(){return this.current||(this.current=f.nodes.shift()),this.current},next:function(){this.current=null},remove:function(){s.removeChild(this.get()),this.current=null},getNonEmpty:function(){for(var e,t=this.get();t&&isSpan(t)&&""==t.currentText;)if(!window.opera||(null!=(e=t).previousSibling&&!isBR(e.previousSibling)||null!=e.nextSibling&&!isBR(e.nextSibling))){var i=t;this.remove(),t=this.get(),select.snapshotMove(i.firstChild,t&&(t.firstChild||t),0)}else this.next(),t=this.get();return t}},y=!1,m=!0,C=0;return forEach(g,(function(i){var r=v.getNonEmpty();if("\n"==i.value){if(!isBR(r))throw"Parser out of sync. Expected BR.";if(!r.dirty&&r.indentation||(y=!0),d(e),e=r,r.parserFromHere=g.copy(),r.indentation=i.indentation,r.dirty=!1,null==l&&r==t)throw StopIteration;if(null!=l&&o()>=l||!y&&!m&&C>1&&!n)throw StopIteration;m=y,y=!1,C=0,v.next()}else{if(!isSpan(r))throw"Parser out of sync. Expected SPAN.";if(r.dirty&&(y=!0),C++,function(e,t){return!t.reduced&&t.currentText==e.value&&t.className==e.style}(i,r))r.dirty=!1,v.next();else{y=!0;var a=function(e){var t=makePartSpan(e.value,c.doc);return t.className=e.style,t}(i);s.insertBefore(a,r),h&&h(a,i,c);for(var f=i.value.length,p=0;f>0;){var x=(r=v.get()).currentText.length;select.snapshotReplaceNode(r.firstChild,a.firstChild,f,p),x>f?(u(r,f),f=0):(f-=x,p+=x,v.remove())}}}})),d(e),webkitLastLineHack(this.container),{node:v.getNonEmpty(),dirty:y}}},a}();addEventHandler(window,"load",(function(){var e=window.frameElement.CodeMirror;e.editor=new Editor(e.options);this.parent.setTimeout(method(e,"init"),0)}));